<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Matrix Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>

    <!-- Підключення модулів -->
    <script src="./login/login.js"></script>
    <script src="./sidebar/sidebar.js"></script>
    <script src="./user/user.js"></script>
    <script src="./chat.js"></script>

    <!-- Стилі -->
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="./sidebar/sidebar.css">
    <link rel="stylesheet" href="./login/login.css">
</head>

<body class="bg-gray-100 w-full h-screen">
    <div x-data="chatApp()" class="flex w-full h-full">

        <!-- Sidebar (лише після логіну) -->
        <div id="sidebar-container" class="sidebar bg-gray-50 border-r border-gray-200" x-show="accessToken"
            style="display: none;"></div>

        <!-- Основна частина -->
        <div class="flex flex-col w-full h-full">

            <!-- ✅ Центрований логін з маленьким вікном -->
            <div id="login-container" class="flex items-center justify-center w-full h-full" x-show="!accessToken"
                style="display: none;">
                <div id="login-box" class="bg-white shadow-lg rounded-lg p-8 w-full max-w-sm">
                    <!-- Сюди вставляється login.html -->
                </div>
            </div>

            <!-- Контент після логіну -->
            <div class="flex flex-row gap-4 w-full h-full p-4" x-show="accessToken" style="display: none;">
                <!-- Chat -->
                <div id="chat-container" class="flex-grow"></div>

                <!-- Users -->
                <div id="user-container" class="w-80 flex-shrink-0"></div>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // login
            fetch('./login/login.html')
                .then(res => res.text())
                .then(html => document.getElementById('login-box').innerHTML = html)
                .catch(err => console.error('Error loading login:', err));

            // sidebar
            fetch('./sidebar/sidebar.html')
                .then(res => res.text())
                .then(html => document.getElementById('sidebar-container').innerHTML = html)
                .catch(err => console.error('Error loading sidebar:', err));

            // chat
            fetch('./chat.html')
                .then(res => res.text())
                .then(html => document.getElementById('chat-container').innerHTML = html)
                .catch(err => console.error('Error loading chat:', err));

            // user
            fetch('./user/user.html')
                .then(res => res.text())
                .then(html => document.getElementById('user-container').innerHTML = html)
                .catch(err => console.error('Error loading user:', err));
        });

        function chatApp() {
            return {
                username: '',
                password: '',
                accessToken: '',
                userId: '',
                roomId: '',
                joinRoomId: '',
                newRoomName: '',
                newRoomId: '',
                rooms: [],
                messages: [],
                newMessage: '',
                inviteUser: '',
                roomMembers: [],
                error: '',
                lastSyncToken: '',

                login,
                createRoom,
                fetchRoomsWithNames,
                joinRoom,
                inviteUserToRoom,
                getRoomName,
                switchRoom,
                sendMessage,
                fetchMessages,
                fetchRoomMembers,
                leaveRoom,
                kickUser
            }
        }
    </script>
</body>

</html>